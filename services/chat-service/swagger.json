{
  "openapi": "3.0.0",
  "info": {
    "title": "Chat Service API",
    "version": "1.0.0",
    "description": "Real-time chat microservice for Nexun using Socket.IO"
  },
  "servers": [
    {
      "url": "http://localhost:3002",
      "description": "Chat Service (Direct)"
    },
    {
      "url": "http://localhost:3000/api/chat",
      "description": "Chat Service (via API Gateway)"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "summary": "Health check endpoint",
        "tags": ["Health"],
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { "type": "string", "example": "ok" },
                    "service": { "type": "string", "example": "chat-service" },
                    "timestamp": { "type": "string", "format": "date-time" },
                    "onlineUsers": { "type": "number", "example": 5 }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ChatMessage": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "roomId": { "type": "string" },
          "senderId": { "type": "string" },
          "senderName": { "type": "string" },
          "senderPicture": { "type": "string" },
          "content": { "type": "string" },
          "timestamp": { "type": "string", "format": "date-time" },
          "type": {
            "type": "string",
            "enum": ["text", "image", "file", "system"]
          },
          "metadata": { "type": "object" }
        }
      },
      "ChatRoom": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "type": {
            "type": "string",
            "enum": ["direct", "group", "channel"]
          },
          "visibility": {
            "type": "string",
            "enum": ["public", "private"],
            "description": "Room visibility: public (visible to everyone) or private (requires access code)"
          },
          "code": {
            "type": "string",
            "description": "Access code for private rooms (6-8 alphanumeric characters, only present for private rooms)"
          },
          "participants": {
            "type": "array",
            "items": { "type": "string" }
          },
          "createdBy": { "type": "string" },
          "createdAt": { "type": "string", "format": "date-time" },
          "updatedAt": { "type": "string", "format": "date-time" }
        }
      }
    }
  },
  "x-socketio": {
    "namespace": "/",
    "events": {
      "room:join": {
        "description": "Join a chat room. For private rooms, the code is required.",
        "payload": {
          "type": "object",
          "required": ["roomId"],
          "properties": {
            "roomId": { "type": "string" },
            "code": {
              "type": "string",
              "description": "Access code (required for private rooms)"
            }
          }
        },
        "response": {
          "room:joined": {
            "type": "object",
            "properties": {
              "roomId": { "type": "string" },
              "room": { "$ref": "#/components/schemas/ChatRoom" }
            }
          }
        },
        "errors": {
          "CODE_REQUIRED": "Code required for private rooms",
          "INVALID_CODE": "Invalid access code",
          "ROOM_NOT_FOUND": "Room not found"
        }
      },
      "room:join-by-code": {
        "description": "Join a private room using only the access code",
        "payload": {
          "type": "object",
          "required": ["code"],
          "properties": {
            "code": {
              "type": "string",
              "description": "6-8 character alphanumeric access code"
            }
          }
        },
        "response": {
          "room:joined": {
            "type": "object",
            "properties": {
              "roomId": { "type": "string" },
              "room": { "$ref": "#/components/schemas/ChatRoom" }
            }
          }
        },
        "errors": {
          "INVALID_CODE_FORMAT": "Invalid code format (must be 6-8 alphanumeric characters)",
          "ROOM_NOT_FOUND": "Room not found with this code",
          "NOT_PRIVATE_ROOM": "This code does not correspond to a private room"
        }
      },
      "room:leave": {
        "description": "Leave a chat room",
        "payload": {
          "type": "object",
          "required": ["roomId"],
          "properties": {
            "roomId": { "type": "string" }
          }
        }
      },
      "room:create": {
        "description": "Create a new chat room. Private rooms will automatically generate a unique access code.",
        "payload": {
          "type": "object",
          "required": ["name", "type", "visibility"],
          "properties": {
            "name": { "type": "string" },
            "description": { "type": "string" },
            "type": {
              "type": "string",
              "enum": ["direct", "group", "channel"]
            },
            "visibility": {
              "type": "string",
              "enum": ["public", "private"],
              "description": "Room visibility: public (visible to everyone) or private (requires access code)"
            },
            "participants": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "response": {
          "room:created": {
            "$ref": "#/components/schemas/ChatRoom",
            "description": "Returns the created room with the access code if it's private"
          }
        },
        "errors": {
          "VALIDATION_ERROR": "Name, type, and visibility are required"
        }
      },
      "message:send": {
        "description": "Send a message to a room",
        "payload": {
          "type": "object",
          "required": ["roomId", "content"],
          "properties": {
            "roomId": { "type": "string" },
            "content": { "type": "string" },
            "type": {
              "type": "string",
              "enum": ["text", "image", "file"],
              "default": "text"
            },
            "metadata": { "type": "object" }
          }
        },
        "response": {
          "message:new": {
            "$ref": "#/components/schemas/ChatMessage"
          }
        }
      },
      "messages:get": {
        "description": "Get messages from a room",
        "payload": {
          "type": "object",
          "required": ["roomId"],
          "properties": {
            "roomId": { "type": "string" },
            "limit": { "type": "number", "default": 50 },
            "lastMessageId": { "type": "string" }
          }
        },
        "response": {
          "messages:list": {
            "type": "object",
            "properties": {
              "roomId": { "type": "string" },
              "messages": {
                "type": "array",
                "items": { "$ref": "#/components/schemas/ChatMessage" }
              }
            }
          }
        }
      },
      "user:online": {
        "description": "Emitted when a user comes online",
        "payload": {
          "type": "object",
          "properties": {
            "userId": { "type": "string" }
          }
        }
      },
      "user:offline": {
        "description": "Emitted when a user goes offline",
        "payload": {
          "type": "object",
          "properties": {
            "userId": { "type": "string" }
          }
        }
      }
    }
  }
}

